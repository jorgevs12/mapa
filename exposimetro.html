<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=245, initial-scale=1" />
<title>Medidor dB</title>
<style>
  :root {
    --w: 245px;
    --h: 145px;
    --bg: #fff;
    --fg: #000;
    --muted: #000;
    --needle: #ff4d67;
    --tick: #000;
    --arc: #fff;
  }
  html, body {
    margin: 0;
    background: var(--bg);
    color: var(--fg);
    font-family: system-ui, sans-serif;
  }
  .wrap {
    width: var(--w);
    height: var(--h);
    display: grid;
    place-items: center;
  }
  svg {
    width: var(--w);
    height: var(--h);
    overflow: visible;
  }
</style>
</head>
<body>
<div class="wrap">
  <svg viewBox="0 0 245 145">
    <!-- Arco base -->
    <path d="M20,125 A102.5,102.5 0 0 1 225,125"
          fill="none" stroke="var(--arc)" stroke-width="8" stroke-linecap="round"/>

    <!-- Arco activo -->
    <path id="arcActive" d=""
          fill="none" stroke="#49d17a" stroke-width="8" stroke-linecap="round"/>

    <!-- Ticks -->
    <g id="ticks"></g>

    <!-- Aguja -->
    <g id="needle">
      <line id="needleLine" x1="122.5" y1="125" x2="122.5" y2="5"
            stroke="var(--needle)" stroke-width="3.5" stroke-linecap="round"/>
      <circle cx="122.5" cy="125" r="6" fill="var(--needle)"/>
    </g>

    <!-- Etiquetas -->
    <g id="labels" fill="var(--muted)" font-size="11" text-anchor="middle"></g>

    <!-- Marca “dB” -->
    <text x="122.5" y="138" fill="var(--muted)" font-size="12" text-anchor="middle">dB</text>
  </svg>
</div>

<script>
  const MIN_DB = 0;
  const MAX_DB = 140;
  const CX = 122.5, CY = 125;
  const R = 102.5;
  const START_DEG = 180;
  const END_DEG = 0;
  const toRad = a => (a * Math.PI) / 180;

  const params = new URLSearchParams(location.search);
  const raw = parseFloat(params.get("db"));
  const targetDb = Number.isFinite(raw) ? Math.max(MIN_DB, Math.min(MAX_DB, raw)) : 0;

  const tickG = document.getElementById("ticks");
  const labelG = document.getElementById("labels");
  const majors = [0,20,40,60,80,100,120,140];
  majors.forEach(v => {
    const t = (v - MIN_DB) / (MAX_DB - MIN_DB);
    const ang = START_DEG - t * (START_DEG - END_DEG);
    const x1 = CX + (R - 8) * Math.cos(toRad(ang));
    const y1 = CY - (R - 8) * Math.sin(toRad(ang));
    const x2 = CX + R * Math.cos(toRad(ang));
    const y2 = CY - R * Math.sin(toRad(ang));

    const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
    tick.setAttribute("x1", x1); tick.setAttribute("y1", y1);
    tick.setAttribute("x2", x2); tick.setAttribute("y2", y2);
    tick.setAttribute("stroke", "var(--tick)");
    tick.setAttribute("stroke-width", "2");
    tick.setAttribute("stroke-linecap", "round");
    tickG.appendChild(tick);

    const lx = CX + (R - 22) * Math.cos(toRad(ang));
    const ly = CY - (R - 22) * Math.sin(toRad(ang));
    const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
    label.setAttribute("x", lx); label.setAttribute("y", ly + 4);
    label.textContent = v;
    labelG.appendChild(label);
  });

  function arcPathForDb(db) {
    const clamp = Math.max(MIN_DB, Math.min(MAX_DB, db));
    const tEnd = (clamp - MIN_DB) / (MAX_DB - MIN_DB);
    const angStart = START_DEG;
    const angEnd = START_DEG + tEnd * (END_DEG - START_DEG );

    const x0 = CX + R * Math.cos(toRad(angStart));
    const y0 = CY - R * Math.sin(toRad(angStart));
    const x1 = CX + R * Math.cos(toRad(angEnd));
    const y1 = CY - R * Math.sin(toRad(angEnd));

    const delta = Math.abs(angEnd - angStart);
    const largeArc = delta > 180 ? 1 : 0;

    return `M ${x0},${y0} A ${R},${R} 0 ${largeArc} 1 ${x1},${y1}`;
  }

  function getArcColor(db) {
    if (db >= 100) return "#ff4d4d";
    if (db >= 70) return "#ffaa33";
    return "#49d17a";
  }

  function setNeedle(db) {
    const t = (db - MIN_DB) / (MAX_DB - MIN_DB);
    const ang = START_DEG - t * (START_DEG - END_DEG);
    const x = CX + (R - 25) * Math.cos(toRad(ang));
    const y = CY - (R - 25) * Math.sin(toRad(ang));
    const needleLine = document.getElementById("needleLine");
    needleLine.setAttribute("x2", x);
    needleLine.setAttribute("y2", y);
  }

  let currentDb = 0;
  const arcActive = document.getElementById("arcActive");
  function animate() {
    const diff = targetDb - currentDb;
    if (Math.abs(diff) < 0.1) {
      currentDb = targetDb;
    } else {
      currentDb += diff * 0.12;
    }
    arcActive.setAttribute("d", arcPathForDb(currentDb));
    arcActive.setAttribute("stroke", getArcColor(currentDb));
    setNeedle(currentDb);
    if (currentDb !== targetDb) requestAnimationFrame(animate);
  }
  arcActive.setAttribute("d", arcPathForDb(0));
  arcActive.setAttribute("stroke", getArcColor(0));
  setNeedle(0);
  requestAnimationFrame(animate);
</script>
</body>
</html>




